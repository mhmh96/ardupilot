# hw definition file for processing by chibios_pins.py
# for ChromAero hardware.


# MCU class and specific type
MCU STM32H7xx STM32H743xx


# board ID for firmware load
APJ_BOARD_ID 1025


# crystal frequency, setup to use external oscillator
OSCILLATOR_HZ 25000000


FLASH_SIZE_KB 2048
env OPTIMIZE -O2


# bootloader takes first sector
FLASH_RESERVE_START_KB 128


#  I2C buses
I2C_ORDER I2C1 I2C2


# order of UARTs (and USB)
SERIAL_ORDER OTG1 USART1 USART2 EMPTY EMPTY EMPTY UART6 UART7 UART8


# LEDs
PD12  LED_R1 OUTPUT OPENDRAIN HIGH GPIO(0)
PD13  LED_G1 OUTPUT OPENDRAIN LOW GPIO(1)
PD14  LED_B1 OUTPUT OPENDRAIN LOW GPIO(2)


define HAL_GPIO_A_LED_PIN 0
define HAL_GPIO_B_LED_PIN 1
define HAL_GPIO_C_LED_PIN 2


# USB
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1


# SPI1 for BMI088
PE1 ACC_CS CS
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

# I2C2 for baro
PB10 I2C2_SCL I2C2 PULLUP
PB11 I2C2_SDA I2C2 PULLUP


PC3 BATT_VOLTAGE_SENS ADC1 SCALE(1)
PC2 BATT_CURRENT_SENS ADC1 SCALE(1)


# USART6 - RCIN
PA10 USART1_RX USART6


# I2C1 bus
PB6 I2C1_SDA I2C1
PB7 I2C1_SCL I2C1


# I2C2 bus
PB11  I2C2_SDA I2C1
PB10  I2C2_SCL I2C1


# Motors
PE9  TIM3_CH4 TIM3 PWM(1) GPIO(50)          # 1
PE11 TIM1_CH1 TIM1 PWM(2) GPIO(51)          # 2
PE13 TIM1_CH2 TIM1 PWM(3) GPIO(52) BIDIR    # 3
PE14 TIM3_CH3 TIM3 PWM(4) GPIO(53) BIDIR    # 4


define HAL_STORAGE_SIZE 16384
# use last 2 pages for flash storage
# H743 has 16 pages of 128k each
STORAGE_FLASH_PAGE 14


# spi devices
SPIDEV bmi088_a SPI1 DEVID1  ACC_CS     MODE3  10*MHZ 10*MHZ


# no built-in compass, but probe the i2c bus for all possible
define ALLOW_ARM_NO_COMPASS
define HAL_PROBE_EXTERNAL_I2C_COMPASSES
define HAL_I2C_INTERNAL_MASK 0


# one IMU
IMU BMI088 SPI:bmi055_a SPI:bmi055_g ROTATION_ROLL_180_YAW_90
define HAL_DEFAULT_INS_FAST_SAMPLE 1


# one BARO
BARO DPS310 I2C:0:0x76


PB35 BATT_VOLTAGE_SENS ADC1 SCALE(1)
PC4 BATT_CURRENT_SENS ADC1 SCALE(1)


